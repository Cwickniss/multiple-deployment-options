---
stages:
- name: BUILD
  inputs:
  - type: git
    branch: dev
    service: ${REPO}
  triggers:
  - type: commit
  jobs:
  - name: Build
    type: builder
- name: DEPLOY
  inputs:
  - type: job
    stage: BUILD
    job: Build
  triggers:
  - type: stage
  properties:
  - name: CF_APP_NAME
    value: ${CF_APP_NAME}
  - name: BLUEMIX_API_KEY
    value: ""
  - name: CLUSTER_NAME
    value: ""
  jobs:
 - name: CloudFoundry Deploy
   type: deployer
   target:
     region_id: ${REGION_ID}
     organization: ${ORG_NAME}
     space: ${SPACE_NAME}
     application: ${CF_APP_NAME}
   script: |-
     #!/bin/bash
     ./.bluemix/pipeline-DEPLOY-CloudFoundry.sh
 - name: OpenWhisk Deploy
   type: deployer
   target:
     region_id: ${REGION_ID}
     organization: ${ORG_NAME}
     space: ${SPACE_NAME}
     application: ${CF_APP_NAME}
   script: |-
     #!/bin/bash
     ./.bluemix/pipeline-DEPLOY-OpenWhisk.sh
  # - name: Kubernetes Deploy
  #   type: deployer
  #   target:
  #     region_id: ${PROD_REGION_ID}
  #     organization: ${PROD_ORG_NAME}
  #     space: ${PROD_SPACE_NAME}
  #     application: ${CF_APP_NAME}
  #   script: |-
  #     #!/bin/bash
  #     ./.bluemix/pipeline-DEPLOY-Kubernetes.sh
